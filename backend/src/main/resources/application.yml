app:
    frontend:
        base-url: ${FRONTEND_URL}
    jwt:
        alg: HS512
        issuer: 'NULL'
        secret: ${JWT_SECRET_KEY}
        ttlSeconds:
            ACCESS: 900
            OAUTH_STATE: 300
            RESET_PASSWORD: 1800
            VERIFY_EMAIL: 86400
    oauth2:
        provider: google,facebook
    cookie:
        domain: ${COOKIE_DOMAIN:localhost}
        secure: ${COOKIE_SECURE:false}
cloudinary:
    api-key: ${CLOUDINARY_API_KEY}
    api-secret: ${CLOUDINARY_API_SECRET}
    cloud-name: ${CLOUDINARY_CLOUD_NAME}
    upload-url: https://api.cloudinary.com/v1_1/${cloudinary.cloud-name}/image/upload
logging:
    level:
        org:
            hibernate:
                sql: DEBUG
                orm:
                    jdbc:
                        bind: trace
            springframework:
                security: DEBUG
                cache: DEBUG
server:
    port: 8089
spring:
    application:
        name: backend
    cache:
        type: redis
        redis:
            time-to-live: 3600000 # 1 hour default
        values:
            userCache: users
            productCache: products
            productVariantsCache: productVariants
            productListCache: productList
            categoryCache: categories
            brandCache: brands
            discountCache: discounts
            bannerCache: banners
            provinceCache: provinces
            districtCache: districts
            wardCache: wards
            orderCache: orders
            cartCache: carts
            shippingCache: shipping
    data:
        redis:
            host: ${REDIS_HOST:redis}
            port: 6379
    datasource:
        driver-class-name: org.postgresql.Driver
        hikari:
            data-source-properties:
                cachePrepStmts: true
                cacheResultSetMetadata: true
                cacheServerConfiguration: true
                elideSetAutoCommits: true
                maintainTimeStats: false
                prepStmtCacheSize: 250
                prepStmtCacheSqlLimit: 2048
                rewriteBatchedStatements: true
                useLocalSessionState: true
                useServerPrepStmts: true
            maximum-pool-size: 5
            pool-name: RestDB-Pool
        password: ${POSTGRES_PASSWORD}
        url: ${POSTGRES_URL}
        username: ${POSTGRES_USER}
    devtools:
        restart:
            enabled: true
    flyway:
        baseline-on-migrate: true
        baseline-version: 1
        enabled: true

        out-of-order: true
        validate-on-migrate: false
    jpa:
        database: postgresql
        hibernate:
            ddl-auto: validate
        properties:
            hibernate:
                dialect: org.hibernate.dialect.PostgreSQLDialect
                format_sql: true
                show_sql: true
    mail:
        host: ${MAIL_HOST:smtp.gmail.com}
        port: ${MAIL_PORT:587}
        username: ${MAIL_USERNAME}
        password: ${MAIL_PASSWORD}
        properties:
            mail:
                smtp:
                    auth: true
                    starttls:
                        enable: true

    security:
        oauth2:
            client:
                provider:
                    facebook:
                        authorization-uri: https://www.facebook.com/v16.0/dialog/oauth
                        token-uri: https://graph.facebook.com/v16.0/oauth/access_token
                        user-info-uri: https://graph.facebook.com/me?fields=id,name,email,picture.width(200).height(200)
                        user-name-attribute: id
                registration:
                    facebook:
                        client-id: ${FACEBOOK_CLIENT_ID}
                        client-name: Facebook
                        client-secret: ${FACEBOOK_CLIENT_SECRET}
                        redirect-uri: ${BASE_URL}/login/oauth2/code/{registrationId}
                        scope: public_profile,email
                    google:
                        client-id: ${GOOGLE_CLIENT_ID}
                        client-secret: ${GOOGLE_CLIENT_SECRET}
                        redirect-uri: ${GOOGLE_REDIRECT_URI}
                        scope: openid, profile, email
    graphql:
        cors:
            allowed-origins: http://localhost:4200
            allowed-methods: GET,POST,PUT,DELETE,OPTIONS
            allowed-headers: "Content-Type, Authorization"
            allow-credentials: true
springdoc:
    api-docs:
        path: /api-docs
    default-consumes-media-type: application/json
    default-produces-media-type: application/json
    swagger-ui:
        path: /swagger-ui
upload:
    type:
        other:
            allowed-formats: jpg,png,webp
            folder-pattern: others/%s
            max-size: 5000000
        avatar:
            allowed-formats: jpg,png,webp
            folder-pattern: users/%s/avatar
            max-size: 2000000
            transformations: c_limit,w_400
        banner:
            allowed-formats: jpg,webp
            folder-pattern: banners/%s
            max-size: 8000000
            transformations: c_limit,w_1600
        product:
            allowed-formats: jpg,png,webp
            folder-pattern: products/%s/images
            max-size: 10000000
            transformations: c_limit,w_1200
        user:
            folder-pattern: "users/%s"
            max-size: 5242880 # 5MB
            allowed-formats:
                - jpg
                - png
                - jpeg
                - webp
            transformations: "w_500,c_fill,q_auto"
        brand:
            folder-pattern: "brands/%s"
            max-size: 5242880 # 5MB
            allowed-formats:
                - jpg
                - png
                - jpeg
                - webp
            transformations: "w_500,c_limit,q_auto"
        category:
            folder-pattern: "categories/%s"
            max-size: 5242880 # 5MB
            allowed-formats:
                - jpg
                - png
                - jpeg
                - webp
            transformations: "w_500,c_limit,q_auto"
        refund_proof:
            folder-pattern: "refunds/%s"
            max-size: 5242880 # 5MB
            allowed-formats:
                - jpg
                - png
                - jpeg
                - webp
            transformations: "w_1000,c_limit,q_auto"
        return:
            folder-pattern: "returns/%s"
            max-size: 5242880 # 5MB
            allowed-formats:
                - jpg
                - png
                - jpeg
                - webp
            transformations: "w_1000,c_limit,q_auto"
payment:
    vnPay:
        url: ${PAY_URL}
        tmnCode: ${TMN_CODE}
        secretKey: ${SECRET_KEY}
        returnUrl: ${FRONTEND_URL}/payment_return?gateway=vnpay
        version: ${VERSION}
        command: ${COMMAND}
        orderType: ${ORDER_TYPE}
        max_time: ${MAX_TIME}

# Login/Token config
# Expiration for refresh tokens in seconds (default 14 days)
REFRESH_TOKEN_EXPIRATION: ${REFRESH_TOKEN_EXPIRATION:1209600}

resilience4j:
    retry:
        configs:
            default:
                max-attempts: 3
                wait-duration: 1s
                enable-exponential-backoff: true
                exponential-backoff-multiplier: 2
                retry-exceptions:
                    - org.springframework.web.reactive.function.client.WebClientRequestException
                    - java.util.concurrent.TimeoutException
        instances:
            payment-service:
                base-config: default
                max-attempts: 2
            notification-service:
                base-config: default
            ghn:
                base-config: default
                max-attempts: 2
    circuit-breaker:
        configs:
            default:
                sliding-window-size: 10
                minimum-number-of-calls: 5
                permitted-number-of-calls-in-half-open-state: 3
                automatic-transition-from-open-to-half-open-enabled: true
                wait-duration-in-open-state: 30s
                failure-rate-threshold: 50
                record-exceptions:
                    - org.springframework.web.reactive.function.client.WebClientResponseException
                    - java.util.concurrent.TimeoutException
        instances:
            payment-service:
                base-config: default
            notification-service:
                base-config: default

        time-limiter:
            instances:
                payment-service:
                    timeout-duration: 3s
                notification-service:
                    timeout-duration: 5s
# GHN Service
ghn:
    api:
        base-url: ${GHN_API_BASE_URL:https://dev-online-gateway.ghn.vn/shiip/public-api}
        token: ${GHN_API_TOKEN}
        shop-id: ${GHN_SHOP_ID}
        urls:
            provinces: "https://dev-online-gateway.ghn.vn/shiip/public-api/master-data/province"
            districts: "https://dev-online-gateway.ghn.vn/shiip/public-api/master-data/district"
            wards: "https://dev-online-gateway.ghn.vn/shiip/public-api/master-data/ward"
            shop-info: "https://dev-online-gateway.ghn.vn/shiip/public-api/v2/shop/all"
            services: "https://dev-online-gateway.ghn.vn/shiip/public-api/v2/shipping-order/available-services"
            fee: "https://dev-online-gateway.ghn.vn/shiip/public-api/v2/shipping-order/fee"
            leadtime: "https://dev-online-gateway.ghn.vn/shiip/public-api/v2/shipping-order/leadtime"
            create-order: "https://dev-online-gateway.ghn.vn/shiip/public-api/v2/shipping-order/create"
            print-order: "https://dev-online-gateway.ghn.vn/a5/public-api/printA5"
            print-token: "https://dev-online-gateway.ghn.vn/shiip/public-api/v2/a5/gen-token"
            cancel-order: "https://dev-online-gateway.ghn.vn/shiip/public-api/v2/switch-status/cancel"
    defaults:
        payment-type-id: 2 # 1: Người bán/Người gửi trả phí, 2: Người mua/Người nhận trả phí
        required-note: KHONGCHOXEMHANG # CHOTHUHANG | CHOXEMHANGKHONGTHU | KHONGCHOXEMHANG
        service-type-id: 2 # 2: Giao hàng tiêu chuẩn
        timeout: 15s

# Security - Public Endpoints Configuration
security:
    public-endpoints:
        - /api/v1/shipping/provinces
        - /api/v1/banners/public
        - /api/v1/shipping/districts/**
        - /api/v1/shipping/wards/**
        - /api/v1/orders/guest/**
        - /api/v1/orders/guest-lookup/**
        - /api/v1/payment/vnpay/callback
        - /api/v1/payment/*/callback
        - /actuator/health
        - /actuator/info
        - /api/v1/chatbot/**
        - /swagger-ui/**
        - /swagger-ui.html
        - /swagger-resources/**
        - /webjars/**
        - /static/**
        - /public/**
        - /resources/**
        - /favicon.ico
        - /error
google:
    ai:
        gemini:
            api-key: AIzaSyBRsA5NnCOb2EjCYPlj8VXHx0-z2qZwx4o
            embedding-model: text-embedding-004
            chat-model: gemini-2.5-flash-lite
            base-url: https://generativelanguage.googleapis.com

vector:
    database:
        enabled: true
        embedding-dimension: 768
        similarity-threshold: 0.7

async:
    embedding:
        thread-pool-size: 5
        queue-capacity: 100

